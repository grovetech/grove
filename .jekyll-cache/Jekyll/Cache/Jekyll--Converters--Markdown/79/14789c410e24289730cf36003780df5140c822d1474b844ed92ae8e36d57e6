I"E<p>I have long been a fan of WordPress and not so much a fan of the search engine functionality that comes boxed with it. As an Apple Systems Admin I have several WordPress websites running on several OSX Servers. One of the sites that I administer finally got to the size to where the search capabilities of WordPress fell short of the clients desire and I was forced to look into other avenues for searching. I came across, solar. Solr is an open source enterprise search server based on the Lucene Java search library, with XML/HTTP and JSON APIs, hit highlighting, faceted search, caching, replication, and a web administration interface. This looked extremely promising however getting all of the information that I needed in order to get this running on my servers proved to be a cumbersome process, so I am now writing this to consolidate all of the steps and information that I learned while installing and getting Solr to run on our servers.</p>

<p>The first step is to download all of the needed files, download the most recent version of <a href="https://drupal.org/project/apachesolr">Solr</a>, and the <a href="https://wordpress.org/extend/plugins/solr-for-wordpress/">Solr for WordPress plugin</a>. The first part of the documentation here will be on how to install and get Solr running and then the second portion will focus on configuring the Solr for WordPress plugin. For this walkthrough I will be using the example application that comes with Solr. ** Before we proceed you need to open the port 8983 in your servers firewall and or hardware firewall appliance for public access.</p>

<ol>
  <li>
    <p>Expand the Solr archive into a folder in the Applications folder called Solr (/Applications/Solr)</p>
  </li>
  <li>
    <p>For testing and development we can use the example application coming with Solr. This application is found at /Applications/Solr/example.</p>
  </li>
  <li>
    <p>Move the schema.xml that comes with the Solr for WordPress in the folder* /Applications/Solr/example/solr/conf/* (add “.backup” to the original file).</p>
  </li>
</ol>

<p>Now start the solr application by opening the Terminal and executing the command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /Applications/Solr/example/

java <span class="nt">-jar</span> start.jar</code></pre></figure>

<p>Test that your solr server is now available by visiting https://localhost:8983/solr/admin/</p>

<p>now that you have Solr running on your osx server, you need to make sure that it will run in the background even when you logout of the computer. At the moment it is running through Java and when you logout it will stop running. In order to accomplish this you need to create a LaunchD item, this item needs to be placed in the /Library/LaunchDaemons/ folder.</p>

<ol>
  <li>
    <p>Create a new text file name it org.apache.solr.plist</p>
  </li>
  <li>
    <p>Enter the following information into the file</p>
  </li>
</ol>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span>?&gt;
&lt;<span class="o">!</span>DOCTYPE plist PUBLIC -//Apple Computer//DTD PLIST 1.0//EN https://www.apple.com/DTDs/PropertyList-1.0.dtd <span class="o">&gt;</span>
&lt;plist <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span><span class="o">&gt;</span>
   &lt;dict&gt;
      &lt;key&gt;Label&lt;/key&gt;
      &lt;string&gt;org.apache.solr&lt;/string&gt;
      &lt;key&gt;WorkingDirectory&lt;/key&gt;
      &lt;string&gt;/Applications/Solr/example&lt;/string&gt;
      &lt;key&gt;ProgramArguments&lt;/key&gt;
      &lt;array&gt;
         &lt;string&gt;/usr/bin/java&lt;/string&gt;
         &lt;string&gt;-Dezfind&lt;/string&gt;
         &lt;string&gt;-jar&lt;/string&gt;
         &lt;string&gt;/Applications/Solr/example/start.jar&lt;/string&gt;
      &lt;/array&gt;
      &lt;key&gt;RunAtLoad&lt;/key&gt;
      &lt;<span class="nb">true</span> /&gt;
   &lt;/dict&gt;
&lt;/plist&gt;</code></pre></figure>

<p>Once done, place this file in the /Library/LaunchDaemons/ folder and then run this command in terminal</p>

<p>sudo launchctl load /Library/LaunchDaemons/org.apache.solr.plist</p>

<p>this will load the Launch Daemon when the computer restarts, the next step is to restart your server and then make sure that Solr is running by going to the Solr admin URL https://localhost:8983/solr/admin/ or https://server.domain.name:8983/solr/admin/</p>

<p>Now that you have Solr running on the server, and the schema file loaded then you need to make sure that the Solr for WordPress plugin is installed. Note: Solr, does not need to run on the same server as your wordpress install, we have a dedicated Mac Mini server running Solr and it works great. To install Solr for WordPress follow these steps.</p>

<ol>
  <li>
    <p>Upload the solr-for-wordpress folder to the /wp-content/plugins/ directory</p>
  </li>
  <li>
    <p>Activate the plugin through the ‘Plugins’ menu in WordPress</p>
  </li>
  <li>
    <p>Configure the plugin with the hostname, port, and URI path to your Solr installation.</p>
  </li>
  <li>
    <p>Load all your posts and/or pages via the “Load All Posts” button in the settings page</p>
  </li>
</ol>

<p>Note that this plugin requires you to have an instance of Solr using a schema with the following fields: id, permalink, title, content, numcomments, categories, categoriessrch, tags, tagssrch, author, type, and text. The facet fields (categories, tags, author, and type) should be string fields. You can make tagssrch and categoriessrch of any type you want as they are used for general searching. The plugin is distributed with a Solr schema you can use at solr-for-wordpress/schema.xml.</p>

<p>Now that the plugin is installed and active, login to the administrative area of your WordPress website and go to the “Settings –&gt; Solr Options” area. Once here enter the IP address or Fully Qualified Domain that is running solar. Enter the Port, which in this document is 8983 and enter /solr for the path. Once done, press “Save Changes” it will test the connection to the server and will let you know if it can connect or not.</p>

<p>Once you have gotten the plugin to connect you can “Load All Pages” and “Load All Posts” to build your initial Solr database. Your almost complete now you need to integrate the search results that you get from the Solr server into your WordPress website.</p>

<p>Custom Theme Integration</p>

<ol>
  <li>
    <p>Create a new theme file called “s4w_search.php”.</p>
  </li>
  <li>
    <p>Insert your markup, use template methods s4w_search_form() and s4w_search_results() to insert the search box and results respectively.</p>
  </li>
  <li>
    <p>Add result styling to your theme css file, see solr-for-wordpress/template/search.css for an example.</p>
  </li>
  <li>
    <p>You can use the search widget in your sidebar for search, or use a custom search box that submits the query in the parameter “s”.</p>
  </li>
</ol>

<p>For more information about integrating Solr into your WordPress website you can go to https://wordpress.org/extend/plugins/solr-for-wordpress/</p>

<p>I certainly welcome your feedback so if you have an questions or comments feel free to post them below.</p>

:ET